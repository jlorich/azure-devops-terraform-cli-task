jobs:
# Validates a valid template
- job: InitPlanApplyDestroy
  displayName: Test init, plan, apply, and destroy
  dependsOn:
  pool:
    vmImage: 'Ubuntu-16.04'

  steps:
  - task: terraform@0
    inputs:
      command: 'init'
      cwd: 'tests/Terraform/test-template-azure'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'
      backendAzureProviderStorageAccountName: 'mtcdenterraformsandbox'
      backendAzureContainerName: 'tfstate'
      backendAzureStateFileKey: 'terraform.tfstate'

  - task: terraform@0
    inputs:
      command: 'validate'
      cwd: 'tests/Terraform/test-template-azure/'
      displayName: 'Validate Template'
      
  - task: terraform@0
    inputs:
      command: 'plan'
      cwd: 'tests/Terraform/test-template-azure'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'

  - task: terraform@0
    inputs:
      command: 'apply'
      cwd: 'tests/Terraform/test-template-azure'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'

  - task: terraform@0
    inputs:
      command: 'destroy'
      cwd: 'tests/Terraform/test-template-azure'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'
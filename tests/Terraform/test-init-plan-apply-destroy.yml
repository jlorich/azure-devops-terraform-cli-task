jobs:
# Validates a valid template
- job: InitPlanApplyDestroy
  displayName: Init, Plan, Apply, Destroy
  dependsOn:
  pool:
    vmImage: 'Ubuntu-16.04'

  steps:
    inputs:
      command: 'init'
      cwd: 'test/Terraform/test-template'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'
      backendAzureProviderStorageAccountName: 'mtcdenterraformsandbox'
      backendAzureContainerName: 'tfstate'
      backendAzureStateFileKey: 'terraform.tfstate'

  - task: terraform@0
    inputs:
      command: 'plan'
      cwd: 'test/Terraform/test-template'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'

  - task: terraform@0
    inputs:
      command: 'apply'
      cwd: 'test/Terraform/test-template'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'

  - task: terraform@0
    inputs:
      command: 'destroy'
      cwd: 'test/Terraform/test-template'
      provider: 'azure'
      providerAzureConnectedServiceName: 'MTC Denver Sandbox'